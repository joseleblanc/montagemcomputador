<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exame de Certifica√ß√£o | Telecurso</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --azul: #003366; --azul-claro: #0056b3; --amarelo: #ffcc00; --fundo: #f4f7f9;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--fundo); margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        header { text-align: center; border-bottom: 2px solid var(--azul); margin-bottom: 30px; padding-bottom: 10px; }
        .questao { margin-bottom: 25px; padding: 15px; border: 1px solid #eee; border-radius: 8px; }
        .questao p { font-weight: bold; color: var(--azul); margin-top: 0; }
        .opcoes label { display: block; padding: 10px; margin: 5px 0; background: #f9f9f9; border-radius: 5px; cursor: pointer; transition: 0.2s; }
        .opcoes label:hover { background: #eef2f7; }
        .opcoes input { margin-right: 10px; }
        .btn-enviar { width: 100%; padding: 20px; background: var(--azul); color: white; border: none; border-radius: 8px; font-size: 1.2rem; font-weight: bold; cursor: pointer; }
        .btn-enviar:hover { background: var(--azul-claro); }
        #resultado { display: none; text-align: center; padding: 40px; }
        .nota-box { font-size: 3rem; font-weight: bold; margin: 20px 0; }
        .aprovado { color: #25d366; }
        .reprovado { color: #ff4444; }
    </style>
</head>
<body>

<div class="container" id="prova-container">
    <header>
        <h1>Exame T√©cnico Final</h1>
        <p>Responda as 30 quest√µes com aten√ß√£o. Necess√°rio 70% de acerto.</p>
    </header>

    <form id="quiz-form">
        <div id="questoes-lista"></div>
        <button type="button" class="btn-enviar" onclick="processarProva()">FINALIZAR E ENVIAR RESULTADO</button>
    </form>
</div>

<div class="container" id="resultado">
    <h2 id="msg-resultado"></h2>
    <div class="nota-box" id="nota-final">0</div>
    <p id="feedback-detalhado"></p>
    <button class="btn-enviar" onclick="location.href='modulos.html'">VOLTAR PARA M√ìDULOS</button>
</div>

<script>
    const SUPABASE_URL = 'https://ityqcemfbdzgsfmyisqc.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_p6rMiOpEoL6smdIXgOaclQ_TNK0MwNA';
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const bancoQuestoes = [
        { q: "Qual o componente respons√°vel por converter a corrente alternada da tomada em corrente cont√≠nua para as pe√ßas?", a: "Processador", b: "Placa-m√£e", c: "Fonte de Alimenta√ß√£o", d: "SSD", e: "Mem√≥ria RAM", correta: "c" },
        { q: "Para evitar a queima de componentes por eletricidade est√°tica, qual o procedimento correto?", a: "Usar luvas de borracha", b: "Tocar em algo met√°lico aterrado ou usar pulseira antiest√°tica", c: "Lavar as m√£os antes", d: "Montar o PC sobre um tapete de l√£", e: "N√£o h√° riscos com est√°tica", correta: "b" },
        { q: "Qual ferramenta √© a mais essencial e utilizada em quase toda a montagem do PC?", a: "Alicate de press√£o", b: "Chave Phillips imantada", c: "Martelo de borracha", d: "Chave de fenda min√∫scula", e: "Ferro de solda", correta: "b" },
        { q: "Qual o detalhe visual no processador e no soquete que indica o lado correto do encaixe?", a: "Uma seta dourada em um dos cantos", b: "Um c√≥digo de barras", c: "A cor do processador", d: "N√£o h√° indica√ß√£o, encaixa de qualquer lado", e: "O tamanho dos pinos", correta: "a" },
        { q: "Onde deve ser aplicada a pasta t√©rmica?", a: "Nos pinos do processador", b: "No centro da parte met√°lica (IHS) do processador", c: "No slot da mem√≥ria RAM", d: "Abaixo da placa-m√£e", e: "Dentro do soquete", correta: "b" },
        { q: "Como saber se a mem√≥ria RAM foi encaixada corretamente no slot?", a: "Pelo barulho de um 'click' das travas laterais", b: "Pela cor da mem√≥ria", c: "Se o Windows ligar", d: "Se ela ficar solta no slot", e: "Medindo com uma r√©gua", correta: "a" },
        { q: "Para que servem os 'espa√ßadores' que parafusamos no gabinete antes de colocar a placa-m√£e?", a: "Para deixar o PC mais bonito", b: "Para evitar que a placa-m√£e encoste no metal do gabinete e cause curto-circuito", c: "Para segurar os cabos", d: "Para aumentar a ventila√ß√£o embaixo da placa", e: "Para prender o SSD", correta: "b" },
        { q: "Qual o cabo da fonte que possui 24 pinos e alimenta a placa-m√£e?", a: "Cabo EPS", b: "Cabo SATA", c: "Cabo Principal ATX", d: "Cabo PCI-e", e: "Cabo Molex", correta: "c" },
        { q: "Onde o SSD do tipo M.2 √© instalado?", a: "Conectado por um cabo de dados", b: "Diretamente em um slot na placa-m√£e", c: "Na fonte de alimenta√ß√£o", d: "Fora do gabinete", e: "No slot de expans√£o de √°udio", correta: "b" },
        { q: "Ao instalar a placa de v√≠deo, em qual slot da placa-m√£e ela deve ser encaixada?", a: "Slot PCI-Express x16", b: "Slot de Mem√≥ria RAM", c: "Porta USB interna", d: "Soquete do Processador", e: "Slot M.2", correta: "a" },
        { q: "Qual o sentido padr√£o do fluxo de ar em um cooler de gabinete?", a: "Sempre sopra para os lados", b: "O ar entra pela frente/baixo e sai por tr√°s/cima", c: "O ar deve ficar parado dentro do gabinete", d: "Todos os fans devem soprar para dentro", e: "Todos os fans devem soprar para fora", correta: "b" },
        { q: "O que significa o termo 'BIOS' que acessamos no primeiro boot?", a: "Sistema de busca de arquivos", b: "Sistema B√°sico de Entrada e Sa√≠da", c: "Instalador do Windows", d: "Programa de edi√ß√£o de fotos", e: "Backup do HD", correta: "b" },
        { q: "O que √© necess√°rio para iniciar a instala√ß√£o do Windows em um PC novo?", a: "Apenas ligar o PC na internet", b: "Um pendrive de boot com a imagem do sistema", c: "Um CD de m√∫sica", d: "Digitar um c√≥digo no teclado", e: "O Windows j√° vem dentro do processador", correta: "b" },
        { q: "Durante a instala√ß√£o do Windows, o que significa 'formatar' o disco?", a: "Aumentar o tamanho do HD", b: "Apagar os dados e preparar a parti√ß√£o para receber o sistema", c: "Mudar a cor do gabinete", d: "Limpar a poeira das pe√ßas", e: "Instalar os drivers de v√≠deo", correta: "b" },
        { q: "Qual componente armazena os dados de forma permanente, mesmo com o PC desligado?", a: "Mem√≥ria RAM", b: "SSD ou HD", c: "Processador", d: "Cooler", e: "Cache", correta: "b" },
        { q: "Se o PC liga, mas n√£o d√° v√≠deo, qual o primeiro componente a ser conferido e limpo?", a: "Gabinete", b: "Mem√≥ria RAM", c: "Teclado", d: "Cabo de for√ßa da tomada", e: "Mouse", correta: "b" },
        { q: "Para que serve o 'Espelho' traseiro da placa-m√£e?", a: "Para refletir a luz", b: "Para dar acabamento e proteger as entradas USB/V√≠deo contra poeira", c: "Para segurar a placa de v√≠deo", d: "Para esfriar a placa", e: "N√£o tem utilidade", correta: "b" },
        { q: "O cabo EPS (geralmente 4 ou 8 pinos) serve para alimentar especificamente qual pe√ßa?", a: "O HD", b: "O Processador", c: "As luzes do gabinete", d: "O Mouse", e: "A Placa de V√≠deo", correta: "b" },
        { q: "Qual a fun√ß√£o do cooler (dissipador + ventoinha) sobre o processador?", a: "Aumentar a velocidade", b: "Dissipar o calor gerado pelo funcionamento do chip", c: "Gerar energia", d: "Guardar arquivos", e: "Limpar o processador", correta: "b" },
        { q: "O que acontece se voc√™ esquecer de passar a pasta t√©rmica?", a: "O PC n√£o liga", b: "O processador superaquece rapidamente e o PC desliga por seguran√ßa", c: "O Windows fica lento", d: "A internet para de funcionar", e: "A tela fica azul imediatamente", correta: "b" },
        { q: "A bateria CR2032 da placa-m√£e serve para:", a: "Ligar o PC sem tomada", b: "Manter as configura√ß√µes da BIOS e a hora do sistema", c: "Carregar o celular", d: "Esfriar a placa", e: "Aumentar o FPS", correta: "b" },
        { q: "Qual o nome do slot onde encaixamos o processador?", a: "Porta SATA", b: "Soquete", c: "Slot DIMM", d: "Slot PCIe", e: "Baia", correta: "b" },
        { q: "O termo 'Hardware' refere-se a:", a: "Programas e aplicativos", b: "Pe√ßas f√≠sicas do computador", c: "V√≠deos do YouTube", d: "Jogos online", e: "Navegador de internet", correta: "b" },
        { q: "Qual o cabo usado para conectar um HD antigo ou um leitor de DVD na placa-m√£e?", a: "Cabo HDMI", b: "Cabo SATA", c: "Cabo de rede", d: "Cabo VGA", e: "Cabo USB", correta: "b" },
        { q: "O conector 'Front Panel' serve para ligar o qu√™?", a: "O monitor", b: "Os bot√µes de Power e Reset do gabinete", c: "A impressora", d: "O teclado", e: "A caixa de som", correta: "b" },
        { q: "Qual o cuidado ao instalar mem√≥rias RAM se a placa-m√£e tiver 4 slots?", a: "Colocar em qualquer lugar", b: "Seguir o manual para ativar o Dual Channel (geralmente slots 2 e 4)", c: "Usar apenas um slot", d: "Passar pasta t√©rmica na RAM", e: "Colocar todas juntas nos primeiros slots", correta: "b" },
        { q: "O que significa 'Dual Channel'?", a: "Dois monitores", b: "Dois canais de comunica√ß√£o com a mem√≥ria para maior velocidade", c: "Dois processadores", d: "Duas fontes", e: "Dois teclados", correta: "b" },
        { q: "Qual a principal vantagem de um SSD sobre um HD comum?", a: "√â mais pesado", b: "Velocidade de leitura e escrita muito superior", c: "√â mais barato", d: "Gasta mais energia", e: "Faz mais barulho", correta: "b" },
        { q: "Onde conectamos o cabo do monitor se o PC tiver uma placa de v√≠deo dedicada?", a: "Na placa-m√£e", b: "Na pr√≥pria placa de v√≠deo", c: "Na fonte", d: "No gabinete", e: "No processador", correta: "b" },
        { q: "Para finalizar a montagem, o que devemos fazer com os cabos soltos?", a: "Deixar de qualquer jeito", b: "Organizar com abra√ßadeiras para n√£o atrapalhar o fluxo de ar", c: "Cortar os cabos que sobraram", d: "Esconder embaixo do processador", e: "Colar com fita durex", correta: "b" }
    ];

    function embaralhar(array) {
        return array.sort(() => Math.random() - 0.5);
    }

    function carregarProva() {
        const questSelecionadas = embaralhar([...bancoQuestoes]).slice(0, 30);
        const container = document.getElementById('questoes-lista');
        
        container.innerHTML = questSelecionadas.map((item, index) => `
            <div class="questao" data-correta="${item.correta}">
                <p>${index + 1}. ${item.q}</p>
                <div class="opcoes">
                    <label><input type="radio" name="q${index}" value="a"> A) ${item.a}</label>
                    <label><input type="radio" name="q${index}" value="b"> B) ${item.b}</label>
                    <label><input type="radio" name="q${index}" value="c"> C) ${item.c}</label>
                    <label><input type="radio" name="q${index}" value="d"> D) ${item.d}</label>
                    <label><input type="radio" name="q${index}" value="e"> E) ${item.e}</label>
                </div>
            </div>
        `).join('');
    }

    async function processarProva() {
        const questoesDOM = document.querySelectorAll('.questao');
        let acertos = 0;
        let mapaRespostas = {};

        questoesDOM.forEach((q, index) => {
            const selecionada = q.querySelector(`input[name="q${index}"]:checked`);
            const respostaDada = selecionada ? selecionada.value : "pula";
            const respostaCorreta = q.dataset.correta;

            mapaRespostas[`questao_${index + 1}`] = {
                escolhida: respostaDada,
                correta: respostaCorreta,
                status: (respostaDada === respostaCorreta) ? "correto" : "errado"
            };

            if (respostaDada === respostaCorreta) acertos++;
        });

        const notaFinal = Math.round((acertos / 30) * 100);
        const aprovado = notaFinal >= 70;

        try {
            const { data: { user } } = await _supabase.auth.getUser();
            
            // Upsert considerando sua estrutura de colunas exata
            const { error } = await _supabase.from('progresso_alunos').upsert({ 
                user_id: user.id, 
                modulo_id: 100, 
                concluido: true, 
                nota: notaFinal,
                respostas_aluno: mapaRespostas,
                data_conclusao: new Date().toISOString()
            }, { onConflict: 'user_id, modulo_id' });

            if (error) throw error;
            exibirResultado(notaFinal, aprovado);

        } catch (err) {
            console.error("Erro:", err);
            alert("Erro ao salvar. Verifique se rodou o comando SQL no Supabase.");
        }
    }

    function exibirResultado(nota, aprovado) {
        document.getElementById('prova-container').style.display = 'none';
        const resDiv = document.getElementById('resultado');
        resDiv.style.display = 'block';
        
        const notaBox = document.getElementById('nota-final');
        notaBox.innerText = nota;
        notaBox.className = 'nota-box ' + (aprovado ? 'aprovado' : 'reprovado');
        
        document.getElementById('msg-resultado').innerText = aprovado ? "üèÜ PARAB√âNS! VOC√ä FOI APROVADO!" : "‚ùå N√ÉO FOI DESTA VEZ...";
        document.getElementById('feedback-detalhado').innerText = aprovado ? 
            "Seu certificado j√° est√° dispon√≠vel na p√°gina inicial." : 
            "Voc√™ precisa de 70 pontos. Estude os m√≥dulos novamente e tente mais tarde.";
    }

    carregarProva();
</script>
</body>
</html>