<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exame de Certifica√ß√£o | Telecurso</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --azul: #003366; --azul-claro: #0056b3; --amarelo: #ffcc00; --fundo: #f4f7f9; --vermelho: #ff4444;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--fundo); margin: 0; padding: 20px; user-select: none; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        header { text-align: center; border-bottom: 2px solid var(--azul); margin-bottom: 30px; padding-bottom: 10px; }
        
        .regras-box {
            background: #fff3cd; border-left: 5px solid #ffc107; padding: 15px; margin: 20px 0; text-align: left; border-radius: 4px;
        }
        .regras-box h3 { margin: 0 0 10px 0; color: #856404; }
        
        .questao { margin-bottom: 25px; padding: 15px; border: 1px solid #eee; border-radius: 8px; }
        .questao p { font-weight: bold; color: var(--azul); margin-top: 0; }
        .opcoes label { display: block; padding: 10px; margin: 5px 0; background: #f9f9f9; border-radius: 5px; cursor: pointer; transition: 0.2s; }
        .opcoes label:hover { background: #eef2f7; }
        
        .btn-enviar { width: 100%; padding: 20px; background: var(--azul); color: white; border: none; border-radius: 8px; font-size: 1.2rem; font-weight: bold; cursor: pointer; }
        
        #anti-cola-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.98); color: white; z-index: 9999; text-align: center; padding-top: 10%;
        }
        .aviso-card { background: white; color: black; display: inline-block; padding: 40px; border-radius: 15px; max-width: 500px; border: 3px solid var(--vermelho); }

        #resultado { display: none; text-align: center; padding: 40px; }
        .nota-box { font-size: 3rem; font-weight: bold; margin: 20px 0; }
        .aprovado { color: #25d366; }
        .reprovado { color: var(--vermelho); }
    </style>
</head>
<body oncontextmenu="return false;">

<div id="anti-cola-overlay">
    <div class="aviso-card">
        <h2>‚ö†Ô∏è EXAME BLOQUEADO</h2>
        <p>Foi detectada uma mudan√ßa de janela ou aplicativo. Por seguran√ßa, o progresso foi resetado.</p>
        <button class="btn-enviar" onclick="location.reload()">RECOME√áAR AGORA</button>
    </div>
</div>

<div class="container" id="prova-container">
    <header>
        <h1>Exame Final de Hardware</h1>
        <div class="regras-box">
            <h3>üìù Regras Oficiais:</h3>
            <ul>
                <li><strong>Sorteio:</strong> O sistema escolheu 30 quest√µes de um banco de 60.</li>
                <li><strong>Anti-Cola:</strong> Se sair desta p√°gina, a prova trava.</li>
                <li><strong>Aprova√ß√£o:</strong> M√≠nimo de 70% (21 quest√µes corretas).</li>
                <li><strong>Tempo:</strong> N√£o h√° limite, mas seja objetivo.</li>
                <li><strong>Repeti√ß√£o:</strong> Em caso de reprova√ß√£o, refa√ßa o exame quantas vezes quiser.</li>
                <li><strong>N√£o atualize a pagina:</strong> Caso a pagina seja atualizada, o exame ser√° reiniciado. perdendo todas as quest√µes ja respondidas</li>
                <li><strong>Envio:</strong> Clique em "FINALIZAR EXAME" para enviar o exame.</li>
            </ul>
        </div>
    </header>

    <form id="quiz-form">
        <div id="questoes-lista"></div>
        <button type="button" class="btn-enviar" onclick="processarProva()">FINALIZAR EXAME</button>
    </form>
</div>

<div class="container" id="resultado">
    <h2 id="msg-resultado"></h2>
    <div class="nota-box" id="nota-final">0</div>
    <p id="feedback-detalhado"></p>
    <button class="btn-enviar" onclick="location.href='index.html'">SAIR</button>
</div>

<script>
    // Configura√ß√µes Supabase (Substitua se necess√°rio)
    const SUPABASE_URL = 'https://ityqcemfbdzgsfmyisqc.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_p6rMiOpEoL6smdIXgOaclQ_TNK0MwNA';
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    let provaAtiva = true;

    const bancoCompleto = [
        // QUEST√ïES DE MONTAGEM (1-20)
        { q: "Qual componente converte AC (Alternada) em DC (Cont√≠nua)?", a: "Placa-m√£e", b: "Processador", c: "Fonte de Alimenta√ß√£o", d: "SSD", e: "Monitor", correta: "c" },
        { q: "Onde se aplica a pasta t√©rmica?", a: "No slot RAM", b: "No topo do processador (IHS)", c: "Debaixo dos pinos", d: "No cooler do gabinete", e: "Na bateria CMOS", correta: "b" },
        { q: "O que evita a eletricidade est√°tica?", a: "Pulseira antiest√°tica", b: "Luvas de l√£", c: "P√©s descal√ßos", d: "Pano √∫mido", e: "Vento do ventilador", correta: "a" },
        { q: "Qual o cabo principal de energia da placa-m√£e?", a: "SATA", b: "EPS 8 pinos", c: "ATX 24 pinos", d: "Molex", e: "PCI-Express", correta: "c" },
        { q: "A marca triangular no processador serve para:", a: "Indicar a marca", b: "Orientar o encaixe correto no soquete", c: "Passar pasta t√©rmica", d: "Prender o cooler", e: "Medir a temperatura", correta: "b" },
        { q: "Qual slot √© usado para placas de v√≠deo modernas?", a: "PCI", b: "AGP", c: "PCI-Express x16", d: "ISA", e: "SATA Express", correta: "c" },
        { q: "Os espa√ßadores de gabinete servem para:", a: "Beleza", b: "Evitar curto-circuito com o chassi", c: "Segurar o HD", d: "Prender fans", e: "Aumentar o peso", correta: "b" },
        { q: "SSD M.2 √© instalado em qual local?", a: "Cabo de dados", b: "Diretamente na placa-m√£e", c: "Na fonte", d: "No gabinete", e: "Na placa de v√≠deo", correta: "b" },
        { q: "Qual a fun√ß√£o do Espelho Traseiro?", a: "Refletir luz", b: "Acabamento e prote√ß√£o das portas I/O", c: "Segurar a placa", d: "Resfriar", e: "Nenhuma", correta: "b" },
        { q: "O que acontece se esquecer de travar a alavanca do soquete?", a: "Nada", b: "O PC n√£o liga pois n√£o h√° contato el√©trico", c: "O processador queima", d: "O Windows fica lento", e: "O cooler cai", correta: "b" },
        
        // QUEST√ïES DE MANUTEN√á√ÉO E SOFTWARE (21-40)
        { q: "O que √© a BIOS/UEFI?", a: "Sistema operacional", b: "Firmware de controle de hardware b√°sico", c: "Programa de edi√ß√£o", d: "V√≠rus", e: "Driver de som", correta: "b" },
        { q: "Qual o primeiro sintoma de superaquecimento?", a: "Aumento da internet", b: "Desligamento s√∫bito do PC", c: "Tela preta no monitor", d: "Teclado parando", e: "Barulho no HD", correta: "b" },
        { q: "Para que serve o comando 'CheckDisk' (chkdsk)?", a: "Limpar o gabinete", b: "Verificar e corrigir erros no disco r√≠gido", c: "Aumentar a RAM", d: "Baixar drivers", e: "Mudar a senha", correta: "b" },
        { q: "O que significa formata√ß√£o r√°pida?", a: "Limpa fisicamente o disco", b: "Apenas recria a tabela de arquivos", c: "Aumenta o espa√ßo", d: "Remove v√≠rus da BIOS", e: "Instala o Office", correta: "b" },
        { q: "Como limpar contatos de mem√≥ria RAM?", a: "√Ågua e sab√£o", b: "Borracha branca escolar ou √°lcool isoprop√≠lico", c: "Pano √∫mido", d: "Detergente", e: "Lixa de ferro", correta: "b" },
        { q: "Sinal de bateria CMOS (CR2032) fraca:", a: "PC n√£o liga", b: "Data e hora desconfigurando sempre", c: "Internet lenta", d: "Mouse travando", e: "Monitor piscando", correta: "b" },
        { q: "O que √© 'Beep Code'?", a: "C√≥digo de barras", b: "Sinais sonoros que indicam erros de hardware", c: "Senha do Windows", d: "M√∫sica do boot", e: "Barulho do HD", correta: "b" },
        { q: "Principal vantagem do SSD sobre o HDD:", a: "Pre√ßo", b: "Velocidade de acesso e resist√™ncia a choques", c: "Capacidade", d: "Peso", e: "Cores", correta: "b" },
        { q: "O que √© Dual Channel?", a: "Dois monitores", b: "Uso de dois m√≥dulos de RAM para dobrar a largura de banda", c: "Duas fontes", d: "Dois Windows", e: "Duas placas de v√≠deo", correta: "b" },
        { q: "Onde ficam guardados os arquivos quando o PC desliga?", a: "Mem√≥ria RAM", b: "Armazenamento (HD/SSD)", c: "Processador", d: "Cooler", e: "Fonte", correta: "b" },

        // NOVAS QUEST√ïES (41-60)
        { q: "Qual ferramenta mede a tens√£o da fonte?", a: "Term√¥metro", b: "Mult√≠metro", c: "Alicate", d: "Chave de fenda", e: "Lanterna", correta: "b" },
        { q: "O que √© Overclocking?", a: "Limpar o PC", b: "Aumentar a frequ√™ncia de opera√ß√£o do hardware", c: "Diminuir o consumo", d: "Instalar Linux", e: "Trocar o gabinete", correta: "b" },
        { q: "Qual a fun√ß√£o do cooler do processador?", a: "Fazer luz", b: "Remover o calor gerado pelo processador", c: "Limpar poeira", d: "Aumentar os gigahertz", e: "Estabilizar a energia", correta: "b" },
        { q: "O que significa a certifica√ß√£o 80 Plus em fontes?", a: "80 cabos", b: "Efici√™ncia energ√©tica garantida de pelo menos 80%", c: "Pot√™ncia de 80W", d: "Garantia de 80 meses", e: "Suporta 80 graus", correta: "b" },
        { q: "Qual componente processa os gr√°ficos?", a: "Placa de Som", b: "GPU (Placa de V√≠deo)", c: "HD", d: "Mem√≥ria RAM", e: "Fonte", correta: "b" },
        { q: "O que √© um 'Driver'?", a: "Cabo", b: "Software que permite o SO falar com o Hardware", c: "Pe√ßa de metal", d: "Um tipo de v√≠rus", e: "Manual impresso", correta: "b" },
        { q: "Qual a unidade de medida da mem√≥ria RAM?", a: "GHz", b: "GB (Gigabytes)", c: "Watts", d: "Volts", e: "RPM", correta: "b" },
        { q: "O que √© o TDP?", a: "Pre√ßo", b: "Projeto de For√ßa T√©rmica (calor que precisa ser dissipado)", c: "Velocidade de internet", d: "Tamanho do HD", e: "Tipo de tela", correta: "b" },
        { q: "Fun√ß√£o do Filtro de Linha:", a: "Aumentar a velocidade", b: "Proteger contra picos de tens√£o e ru√≠dos na rede", c: "Mudar a voltagem", d: "Ligar o Wi-Fi", e: "Resfriar o PC", correta: "b" },
        { q: "O que fazer se o PC travar na tela da logomarca da placa-m√£e?", a: "Trocar o monitor", b: "Verificar teclado ou perif√©ricos USB em curto", c: "Limpar o gabinete por fora", d: "Comprar um mouse novo", e: "Instalar o Office", correta: "b" },
        { q: "Qual o conector para internet via cabo?", a: "USB", b: "RJ-45 (Ethernet)", c: "HDMI", d: "VGA", e: "P2", correta: "b" },
        { q: "O que √© o soquete LGA?", a: "Pinos no processador", b: "Pinos no soquete da placa-m√£e", c: "Tipo de mem√≥ria", d: "Marca de fonte", e: "Entrada de v√≠deo", correta: "b" },
        { q: "Causa comum de 'Tela Azul' constante:", a: "Monitor sujo", b: "Mem√≥ria RAM com defeito ou drivers inst√°veis", c: "Falta de pasta t√©rmica", d: "Teclado desconectado", e: "Gabinete aberto", correta: "b" },
        { q: "O que √© 'Safe Mode' (Modo de Seguran√ßa)?", a: "Modo para jogos", b: "Inicializa√ß√£o m√≠nima para diagn√≥stico de erros", c: "Antiv√≠rus pago", d: "Modo sem senha", e: "Modo de economia de energia", correta: "b" },
        { q: "Para que serve o dissipador de calor?", a: "Enfeitar", b: "Aumentar a √°rea de contato com o ar para resfriar a pe√ßa", c: "Prender o HD", d: "Gerar energia", e: "Guardar arquivos", correta: "b" },
        { q: "Qual a fun√ß√£o da Ventoinha (Fan) em exaust√£o?", a: "Puxar ar para dentro", b: "Retirar o ar quente de dentro do gabinete", c: "Resfriar o monitor", d: "Limpar as pe√ßas", e: "Fazer sil√™ncio", correta: "b" },
        { q: "O que acontece se ligar o PC sem RAM?", a: "Liga normal", b: "N√£o d√° v√≠deo e emite bipes (se houver speaker)", c: "O monitor queima", d: "O Windows abre direto", e: "A fonte explode", correta: "b" },
        { q: "Qual a voltagem padr√£o de uma porta USB 2.0?", a: "12V", b: "5V", c: "110V", d: "1.2V", e: "220V", correta: "b" },
        { q: "O que √© um SSD NVMe?", a: "SSD mais lento", b: "SSD que usa o barramento PCI-Express para altas velocidades", c: "Um tipo de HD de disco", d: "Uma marca de mem√≥ria", e: "Um cabo de for√ßa", correta: "b" },
        { q: "Qual a fun√ß√£o do conector EPS 12V?", a: "Ligar os LEDs", b: "Alimentar especificamente o processador", c: "Ligar o HD", d: "Conectar o mouse", e: "Alimentar a placa de v√≠deo", correta: "b" }
    ];

    // Fun√ß√£o de embaralhar array (Fisher-Yates)
    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function carregarProva() {
        // Seleciona 30 quest√µes aleat√≥rias do banco de 60
        const questoesSorteio = shuffle([...bancoCompleto]).slice(0, 30);
        const container = document.getElementById('questoes-lista');
        
        container.innerHTML = questoesSorteio.map((item, idx) => {
            // Embaralha as alternativas de cada quest√£o
            let alternativas = [
                { id: "a", texto: item.a },
                { id: "b", texto: item.b },
                { id: "c", texto: item.c },
                { id: "d", texto: item.d },
                { id: "e", texto: item.e }
            ];
            alternativas = shuffle(alternativas);

            return `
                <div class="questao" data-correta="${item.correta}">
                    <p>${idx + 1}. ${item.q}</p>
                    <div class="opcoes">
                        ${alternativas.map(opt => `
                            <label>
                                <input type="radio" name="q${idx}" value="${opt.id}">
                                ${opt.texto}
                            </label>
                        `).join('')}
                    </div>
                </div>
            `;
        }).join('');
    }

    // --- ANTI-COLA ---
    function travarProva() {
        if (provaAtiva) {
            document.getElementById('anti-cola-overlay').style.display = 'block';
            document.getElementById('prova-container').style.filter = 'blur(15px)';
            document.getElementById('prova-container').style.pointerEvents = 'none';
        }
    }

    window.addEventListener('blur', travarProva);
    document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'hidden') travarProva();
    });

    async function processarProva() {
        provaAtiva = false;
        const questoesDOM = document.querySelectorAll('.questao');
        let acertos = 0;
        let resumo = {};

        questoesDOM.forEach((q, i) => {
            const escolhida = q.querySelector(`input[name="q${i}"]:checked`)?.value || "nulo";
            const correta = q.dataset.correta;
            if (escolhida === correta) acertos++;
            resumo[`q${i+1}`] = { escolhida, correta };
        });

        const nota = Math.round((acertos / 30) * 100);
        const aprovado = nota >= 70;

        try {
            const { data: { user } } = await _supabase.auth.getUser();
            await _supabase.from('progresso_alunos').upsert({ 
                user_id: user.id, 
                modulo_id: 100, 
                concluido: true, 
                nota: nota,
                respostas_aluno: resumo,
                data_conclusao: new Date().toISOString()
            }, { onConflict: 'user_id, modulo_id' });

            exibirResultado(nota, aprovado);
        } catch (e) {
            alert("Erro ao salvar resultado. Verifique sua conex√£o.");
            provaAtiva = true;
        }
    }

    function exibirResultado(nota, aprovado) {
        document.getElementById('prova-container').style.display = 'none';
        const resDiv = document.getElementById('resultado');
        resDiv.style.display = 'block';
        document.getElementById('nota-final').innerText = nota;
        document.getElementById('nota-final').className = 'nota-box ' + (aprovado ? 'aprovado' : 'reprovado');
        document.getElementById('msg-resultado').innerText = aprovado ? "üèÜ CERTIFICADO DISPON√çVEL!" : "‚ùå TENTE NOVAMENTE";
    }

    carregarProva();
</script>
</body>
</html>