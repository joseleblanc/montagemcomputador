<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MÃ³dulos | Telecurso PC</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --azul-escuro: #003366;
            --azul-claro: #0056b3;
            --amarelo: #ffcc00;
            --cinza-fundo: #f4f7f9;
            --verde: #28a745;
        }

        body { font-family: 'Segoe UI', sans-serif; background-color: var(--cinza-fundo); margin: 0; padding: 0; }

        header {
            background-color: var(--azul-escuro);
            color: white;
            padding: 20px;
            text-align: center;
            border-bottom: 5px solid var(--amarelo);
        }

        .container { max-width: 1200px; margin: 40px auto; padding: 0 20px; }

        .boas-vindas {
            margin-bottom: 30px;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .grid-modulos {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .card-modulo {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Estilo para mÃ³dulo bloqueado */
        .card-modulo.bloqueado {
            opacity: 0.6;
            cursor: not-allowed;
            filter: grayscale(0.8);
        }

        .card-modulo:not(.bloqueado):hover {
            transform: translateY(-5px);
            border-color: var(--azul-claro);
        }

        .card-banner {
            background: var(--azul-claro);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }

        /* Cores dinÃ¢micas para o banner */
        .card-modulo.concluido .card-banner { background: var(--verde); }
        .card-modulo.bloqueado .card-banner { background: #666; }

        .card-corpo {
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .status-badge {
            font-size: 0.8rem;
            font-weight: bold;
            margin-top: 10px;
            display: block;
        }

        .status-concluido { color: var(--verde); }
        .status-bloqueado { color: #888; }
        .status-disponivel { color: var(--azul-claro); }

        .btn-sair {
            background: #ff4444;
            border: none;
            color: white;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<header>
    <h1>Telecurso: Montagem de PC</h1>
</header>

<div class="container">
    <div class="boas-vindas">
        <div>
            <h2 id="nome-aluno" style="margin:0">Carregando...</h2>
            <p>Seu progresso Ã© salvo automaticamente ao finalizar os desafios.</p>
        </div>
        <button class="btn-sair" onclick="sair()">Sair</button>
    </div>

    <div class="grid-modulos" id="grid-modulos">
        </div>
</div>

<script>
    const SUPABASE_URL = 'https://ityqcemfbdzgsfmyisqc.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_p6rMiOpEoL6smdIXgOaclQ_TNK0MwNA';
    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // DefiniÃ§Ã£o dos mÃ³dulos (mesma ordem do seu HTML original)
    const modulosInfo = [
        { id: 1, titulo: "Conhecendo as peÃ§as", desc: "IdentificaÃ§Ã£o de componentes e funÃ§Ãµes." },
        { id: 2, titulo: "Separando ferramentas", desc: "O que nÃ£o pode faltar na bancada." },
        { id: 3, titulo: "Cuidados de seguranÃ§a", desc: "Eletricidade estÃ¡tica e proteÃ§Ã£o." },
        { id: 4, titulo: "Montando o processador", desc: "Encaixe da CPU e pasta tÃ©rmica." },
        { id: 5, titulo: "Montando a memÃ³ria RAM", desc: "Dual Channel e travas de seguranÃ§a." },
        { id: 6, titulo: "Montando a placa no Gabinete", desc: "Espelho e parafusos de fixaÃ§Ã£o." },
        { id: 7, titulo: "Fonte de alimentaÃ§Ã£o", desc: "InstalaÃ§Ã£o da PSU e roteamento." },
        { id: 8, titulo: "Montando armazenamento", desc: "SSD SATA e M.2 NVMe." },
        { id: 9, titulo: "Montando Placa de vÃ­deo", desc: "Slot PCI-e e alimentaÃ§Ã£o extra." },
        { id: 10, titulo: "Coolers de gabinete", desc: "Configurando o fluxo de ar." },
        { id: 11, titulo: "Primeiro boot de testes", desc: "BIOS e conferÃªncia inicial." },
        { id: 12, titulo: "FormataÃ§Ã£o com Windows", desc: "InstalaÃ§Ã£o do sistema operacional." }
    ];

    async function inicializar() {
        const { data: { user } } = await _supabase.auth.getUser();
        if (!user) {
            window.location.href = "index.html";
            return;
        }

        document.getElementById('nome-aluno').innerText = `Bem-vindo, ${user.email.split('@')[0]}`;

        // Busca o progresso do aluno no Supabase
        const { data: progresso, error } = await _supabase
            .from('progresso_alunos')
            .select('modulo_id')
            .eq('user_id', user.id);

        const concluidos = progresso ? progresso.map(p => p.modulo_id) : [];
        renderizarModulos(concluidos);
    }

    function renderizarModulos(concluidos) {
        const grid = document.getElementById('grid-modulos');
        grid.innerHTML = '';

        modulosInfo.forEach((mod, index) => {
            const isConcluido = concluidos.includes(mod.id);
            
            // LÃ³gica de Bloqueio: O primeiro estÃ¡ sempre aberto. 
            // Os demais sÃ³ abrem se o anterior (index - 1) estiver concluÃ­do.
            const isBloqueado = mod.id !== 1 && !concluidos.includes(mod.id - 1);

            const card = document.createElement('div');
            card.className = `card-modulo ${isBloqueado ? 'bloqueado' : ''} ${isConcluido ? 'concluido' : ''}`;
            
            // SÃ³ adiciona o clique se nÃ£o estiver bloqueado
            if (!isBloqueado) {
                card.onclick = () => window.location.href = `aulas/aula${mod.id}.html`;
            }

            let statusHTML = `<span class="status-badge status-disponivel">Acessar Aula â†’</span>`;
            if (isConcluido) statusHTML = `<span class="status-badge status-concluido">âœ… ConcluÃ­do</span>`;
            if (isBloqueado) statusHTML = `<span class="status-badge status-bloqueado">ðŸ”’ Bloqueado</span>`;

            card.innerHTML = `
                <div class="card-banner">MÃ³dulo ${mod.id.toString().padStart(2, '0')}</div>
                <div class="card-corpo">
                    <h3>${mod.titulo}</h3>
                    <p>${mod.desc}</p>
                    ${statusHTML}
                </div>
            `;
            grid.appendChild(card);
        });
    }

    async function sair() {
        await _supabase.auth.signOut();
        window.location.href = "index.html";
    }

    inicializar();
</script>

</body>
</html>